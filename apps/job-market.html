<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Job market outlook 2016</title>
    <link href="../../stylesheets/main.min.css" rel="stylesheet" />
    <link href="../../stylesheets/apps/job-market.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdn.reflect.io/latest/reflect.js"></script>
  </head>
  <body>
    <h1>CUSTOM CONTROLS & INTERACTIONS</h1>

    <div class="controls-wrapper">
      <div id="industry-controls">
        <label for="major-selects">Industry</label>
        <select name="major-selects">
          <option value="Agriculture &amp; Natural Resources">Agriculture &amp; Natural Resources</option>
          <option value="Arts">Arts</option>
          <option value="Biology &amp; Life Science">Biology &amp; Life Science</option>
          <option value="Business">Business</option>
          <option value="Communications &amp; Journalism">Communications &amp; Journalism</option>
          <option value="Computers &amp; Mathematics">Computers &amp; Mathematics</option>
          <option value="Education">Education</option>
          <option selected value="Engineering">Engineering</option>
          <option value="Health">Health</option>
          <option value="Humanities &amp; Liberal Arts">Humanities &amp; Liberal Arts</option>
          <option value="Industrial Arts &amp; Consumer Services">Industrial Arts &amp; Consumer Services</option>
          <option value="Law &amp; Public Policy">Law &amp; Public Policy</option>
          <option value="Physical Sciences">Physical Sciences</option>
          <option value="Psychology &amp; Social Work">Psychology &amp; Social Work</option>
          <option value="Social Science">Social Science</option>
        </select>
      </div>
      <div id="concentration-controls"></div>
    </div>

    <div class="view-container">
      <div id="view"></div>
    </div>

    <script type="text/javascript">
      var ui = new ReflectUI();

      // set default major
      const major = "Engineering";

      ui.withFilters([{
        "field": "Major Category",
        "op": "=",
        "value": major
      }]);

      ui.withFormatters({
        Major: function(d) {
          return (d.substr(0,1).toUpperCase() + d.substr(1));
        }
      });

      function render() {
        ui.view(document.getElementById('view'), 'Bqpd2IQeTlSOqnKGT9S7PA');
        $('#view2').html('');
      }

      render();

      // filter by "major" using select
      $('select[name=major-selects]').change(function() {
        var major = $(this).val();

        ui.withFilters([{
          "field": "Major Category",
          "op": "=",
          "value": major
        }]);

        render();
        $('#concentration-controls').html('');
      });

      // drill into "concentration"
      function drillIn(data) {
        var concentration = data.rowData.Major;

        ui.withFilters([{
          "field": "Major",
          "op": "=",
          "value": concentration
        }]);

        ui.withFormatters({
          Major: function(d) {
            return (d.substr(0,1).toUpperCase() + d.substr(1));
          }
        });

        ui.view(document.getElementById('view'), '49dITq-EQlyRO-QTnfs7ow');

        $('#concentration-controls').html('<label>Focus</label><p>' + concentration + '<button type="button" id="concentration-btn">&times</button></p>');

        // remove "concentration" filter
        $("#concentration-btn").click(function() {
          $('#concentration-controls').html('');
          render();
        });
      }

      ui.on('bars-majors', 'dataPointClick', function(data) {
        drillIn(data)
      });

      ui.on('bars-salary', 'dataPointClick', function(data) {
        drillIn(data)
      });

    </script>
  </body>
</html>
