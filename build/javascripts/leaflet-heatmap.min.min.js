"use strict";!function(t,i,a){"undefined"!=typeof module&&module.exports?module.exports=a():"function"==typeof define&&define.amd?define(a):i.HeatmapOverlay=a()}(0,void 0,function(){void 0===L.Layer&&(L.Layer=L.Class);var t=L.Layer.extend({initialize:function(t){this.cfg=t,this._el=L.DomUtil.create("div","leaflet-zoom-hide"),this._data=[],this._max=1,this._min=0,this.cfg.container=this._el},onAdd:function(t){var i=t.getSize(),a="undefined"!=typeof require?require("heatmap.js"):window.h337;this._map=t,this._width=i.x,this._height=i.y,this._el.style.width=i.x+"px",this._el.style.height=i.y+"px",this._el.style.position="absolute",this._resetOrigin(),t.getPanes().overlayPane.appendChild(this._el),this._heatmap||(this._heatmap=a.create(this.cfg)),t.on("moveend",this._resetOrigin,this),this._draw()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._el),t.off("moveend",this._resetOrigin,this)},_draw:function(){if(this._map){var i=this._map.getPanes().mapPane,a=i._leaflet_pos;this._el.style[t.CSS_TRANSFORM]="translate("+-Math.round(a.x)+"px,"+-Math.round(a.y)+"px)",this._update()}},_update:function(){var t,i,a,e={max:this._max,min:this._min,data:[]};if(t=this._map.getBounds(),i=this._map.getZoom(),a=Math.pow(2,i),0==this._data.length)return void(this._heatmap&&this._heatmap.setData(e));for(var s=[],h=this.cfg.scaleRadius?a:1,n=0,r=0,d=this.cfg.valueField,o=this._data.length;o--;){var l=this._data[o],_=l[d],m=l.latlng;if(t.contains(m)){n=Math.max(_,n),r=Math.min(_,r);var u=this._map.latLngToContainerPoint(m),f={x:Math.round(u.x),y:Math.round(u.y)};f[d]=_;var g;g=l.radius?l.radius*h:(this.cfg.radius||2)*h,f.radius=g,s.push(f)}}this.cfg.useLocalExtrema&&(e.max=n,e.min=r),e.data=s,this._heatmap.setData(e)},setData:function(t){this._max=t.max||this._max,this._min=t.min||this._min;for(var i=this.cfg.latField||"lat",a=this.cfg.lngField||"lng",e=this.cfg.valueField||"value",t=t.data,s=t.length,h=[];s--;){var n=t[s],r=new L.LatLng(n[i],n[a]),d={latlng:r};d[e]=n[e],n.radius&&(d.radius=n.radius),h.push(d)}this._data=h,this._draw()},addData:function(t){if(t.length>0)for(var i=t.length;i--;)this.addData(t[i]);else{var a=this.cfg.latField||"lat",e=this.cfg.lngField||"lng",s=this.cfg.valueField||"value",h=t,n=new L.LatLng(h[a],h[e]),r={latlng:n};r[s]=h[s],this._max=Math.max(this._max,r[s]),this._min=Math.min(this._min,r[s]),h.radius&&(r.radius=h.radius),this._data.push(r),this._draw()}},_resetOrigin:function(){this._origin=this._map.layerPointToLatLng(new L.Point(0,0));var t=this._map.getSize();this._width===t.x&&this._height===t.y||(this._width=t.x,this._height=t.y,this._el.style.width=this._width+"px",this._el.style.height=this._height+"px"),this._draw()}});return t.CSS_TRANSFORM=function(){for(var t=document.createElement("div"),i=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],a=0;a<i.length;a++){var e=i[a];if(void 0!==t.style[e])return e}return i[0]}(),t});